unit uAppController;

interface

uses
  uUsuarioVO,uInstanceController, FMX.Dialogs, System.SysUtils,
  FireDAC.Comp.Client,IdHashSHA, IdGlobal;

type
    TAppController = class
      private



      public
        function TesteConenxao: Boolean;

        function GerarHashSHA256(const Senha: string): string;
        function CadastraUsuario: Boolean;
        function ValidaUsuario(Email , Senha : String) : Boolean;
    end;

var
  iAppController : TAppController;

implementation

{ TAppController }

function TAppController.ValidaUsuario(Email, Senha: String): Boolean;
begin


end;


function TAppController.GerarHashSHA256(const Senha: string): string;
var
  HashSHA256: TIdHashSHA256;
  HashBytes: TIdBytes;
begin
  // Verifica se a senha foi passada corretamente
  ShowMessage('Senha recebida: ' + Senha);

  HashSHA256 := TIdHashSHA256.Create;
  try
    // Converte a string para bytes usando UTF-8
    HashBytes := ToBytes(Senha, IndyTextEncoding_UTF8);

    // Gera o hash e converte para hexadecimal
    Result := HashSHA256.HashBytesAsHex(HashBytes);
  finally
    HashSHA256.Free;
  end;

  // Exibe o resultado para verificar se o hash foi gerado
  ShowMessage('Hash gerado: ' + Result);
end;


function TAppController.CadastraUsuario : Boolean;
var
  vQuery : TFDQuery;
begin
      Result := False;

      try
          vQuery := TFDQuery.Create(nil);

          try
              with vQuery do
              begin
                    Close;
                    Connection := TInstanceController.GetInstance().AcessarConexao.GetConexao;

                    SQL.Text   := 'INSERT INTO USUARIOS (NOME,EMAIL,SENHA,IS_ACTIVE)'+
                                         'VALUES (:NOME,:EMAIL,:SENHA,:IS_ACTIVE)';

                    ParamByName('NOME').AsString        := iUsuarioVO.NomeUsuario;
                    ParamByName('EMAIL').AsString       := iUsuarioVO.Email;
                    ParamByName('SENHA').AsString       := iUsuarioVO.Senha;
                    ParamByName('IS_ACTIVE').AsInteger  := 1;

                    ExecSQL;

              end;


              Result := True;

          except
            on E:Exception do
              begin
                    Result := False;
              end;
          end;


      finally
          if Assigned(vQuery) then
              vQuery.Free;
      end;


end;


function TAppController.TesteConenxao : Boolean;
begin

      TInstanceController.GetInstance().AcessarConexao.ConfiguraConexao;


end;


end.
